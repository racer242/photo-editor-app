{"version":3,"sources":["reducers/mainReducer.js","improve/react-avatar-editor/utils/load-image-url.js","improve/react-avatar-editor/index.js","improve/react-avatar-editor/utils/load-image-file.js","components/Editor.js","actions/appActions.js","components/Controls.js","components/EditorPlace.js","core/Container.js","core/DataManager.js","core/Control.js","configuration/Settings.js","core/helpers.js","App.js","serviceWorker.js","index.js"],"names":["mainReducerController","state","action","type","addImagesSrc","concat","index","src","imageChanged","imagesTransform","r","rotation","s","scale","saveImages","resultImagesSrc","images","imagesSaved","data","loaded","mainReducer","extraAction","loadImageURL","imageURL","crossOrigin","Promise","resolve","reject","str","image","Image","onload","onerror","match","makeCancelable","promise","hasCanceled_","then","val","isCanceled","error","cancel","isTouchDevice","window","navigator","msMaxTouchPoints","isFileAPISupported","File","draggableEvents","touch","react","down","mouseDown","drag","move","mouseMove","up","mouseUp","native","desktop","deviceEvents","pixelRatio","devicePixelRatio","defaultEmptyImage","x","y","AvatarEditor","props","my","mx","handleImageReady","imageState","getInitialSize","width","height","resource","setState","onImageReady","onLoadSuccess","clearImage","canvas","getContext","clearRect","handleMouseDown","e","event","preventDefault","handleMouseUp","onMouseUp","getElementScale","element","eScale","style","transform","matrixRegex","matches","exec","Number","parentElement","handleMouseMove","containerref","current","mousePositionX","targetTouches","pageX","clientX","mousePositionY","pageY","clientY","newState","rotate","getCroppingRect","lastX","lastY","toRadians","degree","Math","PI","cos","sin","position","getXScale","getYScale","onPositionChange","onMouseMove","setCanvas","this","disableHiDPIScaling","context","loadImage","paint","document","thirdArgument","passiveSupported","options","Object","defineProperty","get","addEventListener","removeEventListener","err","isPassiveSupported","passive","nativeEvents","prevProps","prevState","paintImage","border","onImageChange","Array","isArray","getBorders","borderX","borderY","canvasWidth","canvasHeight","isVertical","cropRect","createElement","translate","drawImage","getDimensions","canvasAspect","imageAspect","min","croppingRect","xMin","xMax","yMin","yMax","disableBoundaryChecks","max","imageFile","loadingImage","reader","FileReader","target","result","readAsDataURL","catch","onLoadFailure","newHeight","newWidth","dimensions","scaleFactor","calculatePosition","save","globalCompositeOperation","restore","fillStyle","color","slice","join","borderRadius","borderSizeX","borderSizeY","beginPath","rect","widthMinusRad","heightMinusRad","arc","lineTo","drawRoundedRect","fill","rest","defaultStyle","cursor","touchAction","attributes","ref","React","Component","defaultProps","Editor","store","targetRefs","containerRefs","i","push","createRef","containerRef","loadButton_clickHandler","bind","unsubscribe","subscribe","onStoreChange","mounted","snapshot","getState","length","targetRef","getImageScaledToCanvas","toDataURL","mimeType","dispatch","id","substr","file","files","useImage","children","imageSrc","addImageTransform","addImagesTransform","imageTransform","key","className","addImagesDefaultSize","pointerEvents","editable","onChange","Controls","scaleRange_changeHandler","rotateRange_changeHandler","clearButton_clickHandler","scaleImage","value","rotateImage","name","minScale","maxScale","step","minRotation","maxRotation","onClick","EditorPlace","editorRef","editorScale","editorX","editorY","continueButton_clickHandler","updateBounds","clientWidth","clientHeight","lastWidth","lastHeight","editorBounds","bounds","loadedImageCount","mainImageSrc","opacity","display","Container","right","sideMenu","top","topMenu","DataManager","isLoading","isLoaded","loader","reloadData","saveStorageData","localStorageManager","load","setStorageData","Control","actionMap","appStartDelay","app","onImage","onImages","dataForStorageChanged","loadTimeout","clearTimeout","stopTimeout","setTimeout","dataLoaded","loadDataError","reloadTimeout","settings","assetsUrl","localStoreName","isMobile","MobileDetect","userAgent","mobile","isLocal","test","location","toString","addImagesDefaultScale","Store","createStore","__REDUX_DEVTOOLS_EXTENSION__","App","initHandler","resizeHandler","windowInnerWidth","documentElement","body","innerWidth","windowInnerHeight","innerHeight","windowWidth","windowHeight","updateLayout","setStoreData","onInit","Boolean","hostname","getElementById","console","log","getAttribute","ReactDOM","render","StrictMode","serviceWorker","ready","registration","unregister","message"],"mappings":"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","file":"static/js/main.06066fe9.chunk.js","sourcesContent":["let mainReducerController = (state={}, action) => {\r\n\r\n    // console.log(\"mainReducer\",action);\r\n\r\n    switch (action.type) {\r\n\r\n\r\n      case 'USE_IMAGE': {\r\n\r\n        let addImagesSrc = state.addImagesSrc.concat();\r\n        addImagesSrc[action.index]=action.src;\r\n        return {\r\n          ...state,\r\n          addImagesSrc,\r\n          imageChanged:true,\r\n        }\r\n      }\r\n\r\n      case 'ROTATE_IMAGE': {\r\n        let imagesTransform=state.imagesTransform.concat();\r\n        imagesTransform[action.index].r=action.rotation;\r\n        return {\r\n          ...state,\r\n          imagesTransform,\r\n        }\r\n      }\r\n\r\n      case 'SCALE_IMAGE': {\r\n        let imagesTransform=state.imagesTransform.concat();\r\n        imagesTransform[action.index].s=action.scale;\r\n        return {\r\n          ...state,\r\n          imagesTransform,\r\n        }\r\n      }\r\n\r\n      case 'CLEAR_IMAGE': {\r\n        let addImagesSrc = state.addImagesSrc.concat();\r\n        addImagesSrc[action.index]=null;\r\n        return {\r\n          ...state,\r\n          addImagesSrc,\r\n          imageChanged:true,\r\n        }\r\n      }\r\n\r\n      case 'SAVE_IMAGES': {\r\n        return {\r\n          ...state,\r\n          saveImages: true,\r\n        }\r\n      }\r\n\r\n      case 'IMAGES_SAVED': {\r\n        return {\r\n          ...state,\r\n          resultImagesSrc:action.images,\r\n          saveImages:false,\r\n          imagesSaved:true,\r\n        }\r\n      }\r\n\r\n\r\n      case 'APP_INIT': {\r\n        return {\r\n          ...state,\r\n          ...action.data,\r\n        }\r\n      }\r\n\r\n      case 'SET_STORE_DATA': {\r\n        return {\r\n          ...state,\r\n          ...action.data,\r\n          loaded:true,\r\n        }\r\n      }\r\n\r\n      case 'CLEAR_ACTION': {\r\n        return {\r\n          ...state,\r\n          action:null,\r\n          imageChanged:false,\r\n          imagesSaved:false,\r\n        }\r\n      }\r\n\r\n      default:\r\n        return state\r\n    }\r\n}\r\n\r\nconst mainReducer = (state={}, action) => {\r\n\r\n  if (action.extraAction) {\r\n    state = mainReducer(state,action.extraAction);\r\n  }\r\n\r\n  state = mainReducerController(state,action);\r\n\r\n  return state;\r\n}\r\n\r\n\r\nexport default mainReducer\r\n","/* eslint-env browser, node */\n\nfunction isDataURL(str) {\n  if (str === null) {\n    return false\n  }\n  const regex = /^\\s*data:([a-z]+\\/[a-z]+(;[a-z-]+=[a-z-]+)?)?(;base64)?,[a-z0-9!$&',()*+;=\\-._~:@/?%\\s]*\\s*$/i\n  return !!str.match(regex)\n}\n\nexport default function loadImageURL(imageURL, crossOrigin) {\n  return new Promise((resolve, reject) => {\n    const image = new Image()\n    image.onload = () => resolve(image)\n    image.onerror = reject\n    if (isDataURL(imageURL) === false && crossOrigin) {\n      image.crossOrigin = crossOrigin\n    }\n    image.src = imageURL\n  })\n}\n","/* eslint-env browser, node */\nimport PropTypes from 'prop-types'\nimport React from 'react'\n\nimport loadImageURL from './utils/load-image-url'\nimport loadImageFile from './utils/load-image-file'\n\nconst makeCancelable = promise => {\n  let hasCanceled_ = false\n\n  const wrappedPromise = new Promise((resolve, reject) => {\n    /* eslint-disable prefer-promise-reject-errors */\n    promise.then(\n      val => (hasCanceled_ ? reject({ isCanceled: true }) : resolve(val)),\n      error => (hasCanceled_ ? reject({ isCanceled: true }) : reject(error))\n    )\n    /* eslint-enable */\n  })\n\n  return {\n    promise: wrappedPromise,\n    cancel() {\n      hasCanceled_ = true\n    },\n  }\n}\n\nconst isTouchDevice = !!(\n  typeof window !== 'undefined' &&\n  typeof navigator !== 'undefined' &&\n  ('ontouchstart' in window || navigator.msMaxTouchPoints > 0)\n)\n\nconst isFileAPISupported = typeof File !== 'undefined'\n\nconst isPassiveSupported = () => {\n  // https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener\n  let passiveSupported = false\n  try {\n    const options = Object.defineProperty({}, 'passive', {\n      get: function() {\n        passiveSupported = true\n      },\n    })\n\n    window.addEventListener('test', options, options)\n    window.removeEventListener('test', options, options)\n  } catch (err) {\n    passiveSupported = false\n  }\n  return passiveSupported\n}\n\nconst draggableEvents = {\n  touch: {\n    react: {\n      down: 'onTouchStart',\n      mouseDown: 'onMouseDown',\n      drag: 'onTouchMove',\n      move: 'onTouchMove',\n      mouseMove: 'onMouseMove',\n      up: 'onTouchEnd',\n      mouseUp: 'onMouseUp',\n    },\n    native: {\n      down: 'touchstart',\n      mouseDown: 'mousedown',\n      drag: 'touchmove',\n      move: 'touchmove',\n      mouseMove: 'mousemove',\n      up: 'touchend',\n      mouseUp: 'mouseup',\n    },\n  },\n  desktop: {\n    react: {\n      down: 'onMouseDown',\n      drag: 'onDragOver',\n      move: 'onMouseMove',\n      up: 'onMouseUp',\n    },\n    native: {\n      down: 'mousedown',\n      drag: 'dragStart',\n      move: 'mousemove',\n      up: 'mouseup',\n    },\n  },\n}\nconst deviceEvents = isTouchDevice\n  ? draggableEvents.touch\n  : draggableEvents.desktop\n\nlet pixelRatio =\n  typeof window !== 'undefined' && window.devicePixelRatio\n    ? window.devicePixelRatio\n    : 1\n\n// Draws a rounded rectangle on a 2D context.\nconst drawRoundedRect = (context, x, y, width, height, borderRadius) => {\n  if (borderRadius === 0) {\n    context.rect(x, y, width, height)\n  } else {\n    const widthMinusRad = width - borderRadius\n    const heightMinusRad = height - borderRadius\n    context.translate(x, y)\n    context.arc(\n      borderRadius,\n      borderRadius,\n      borderRadius,\n      Math.PI,\n      Math.PI * 1.5\n    )\n    context.lineTo(widthMinusRad, 0)\n    context.arc(\n      widthMinusRad,\n      borderRadius,\n      borderRadius,\n      Math.PI * 1.5,\n      Math.PI * 2\n    )\n    context.lineTo(width, heightMinusRad)\n    context.arc(\n      widthMinusRad,\n      heightMinusRad,\n      borderRadius,\n      Math.PI * 2,\n      Math.PI * 0.5\n    )\n    context.lineTo(borderRadius, height)\n    context.arc(\n      borderRadius,\n      heightMinusRad,\n      borderRadius,\n      Math.PI * 0.5,\n      Math.PI\n    )\n    context.translate(-x, -y)\n  }\n}\n\nconst defaultEmptyImage = {\n  x: 0.5,\n  y: 0.5,\n}\n\nclass AvatarEditor extends React.Component {\n\n  //\n  // static propTypes = {\n  //   scale: PropTypes.number,\n  //   rotate: PropTypes.number,\n  //   image: PropTypes.oneOfType([\n  //     PropTypes.string,\n  //     ...(isFileAPISupported ? [PropTypes.instanceOf(File)] : []),\n  //   ]),\n  //   border: PropTypes.oneOfType([\n  //     PropTypes.number,\n  //     PropTypes.arrayOf(PropTypes.number),\n  //   ]),\n  //   borderRadius: PropTypes.number,\n  //   width: PropTypes.number,\n  //   height: PropTypes.number,\n  //   position: PropTypes.shape({\n  //     x: PropTypes.number,\n  //     y: PropTypes.number,\n  //   }),\n  //   color: PropTypes.arrayOf(PropTypes.number),\n  //   crossOrigin: PropTypes.oneOf(['', 'anonymous', 'use-credentials']),\n  //\n  //   onLoadFailure: PropTypes.func,\n  //   onLoadSuccess: PropTypes.func,\n  //   onImageReady: PropTypes.func,\n  //   onImageChange: PropTypes.func,\n  //   onMouseUp: PropTypes.func,\n  //   onMouseMove: PropTypes.func,\n  //   onPositionChange: PropTypes.func,\n  //   disableBoundaryChecks: PropTypes.bool,\n  //   disableHiDPIScaling: PropTypes.bool,\n  //   // disableCanvasRotation: PropTypes.bool,\n  // }\n\n  static defaultProps = {\n    scale: 1,\n    rotate: 0,\n    border: 25,\n    borderRadius: 0,\n    width: 200,\n    height: 200,\n    color: [0, 0, 0, 0.5],\n    onLoadFailure() {},\n    onLoadSuccess() {},\n    onImageReady() {},\n    onImageChange() {},\n    onMouseUp() {},\n    onMouseMove() {},\n    onPositionChange() {},\n    disableBoundaryChecks: false,\n    disableHiDPIScaling: false,\n    // disableCanvasRotation: true,\n  }\n\n  constructor(props) {\n    super(props)\n    this.canvas = null\n  }\n\n  state = {\n    drag: false,\n    my: null,\n    mx: null,\n    image: defaultEmptyImage,\n  }\n\n  componentDidMount() {\n    // scaling by the devicePixelRatio can impact performance on mobile as it creates a very large canvas. This is an override to increase performance.\n    if (this.props.disableHiDPIScaling) {\n      pixelRatio = 1\n    }\n    const context = this.canvas.getContext('2d')\n    if (this.props.image) {\n      this.loadImage(this.props.image)\n    }\n    this.paint(context)\n    if (document) {\n      const passiveSupported = isPassiveSupported()\n      const thirdArgument = passiveSupported ? { passive: false } : false\n\n      const nativeEvents = deviceEvents.native\n      document.addEventListener(\n        nativeEvents.move,\n        this.handleMouseMove,\n        thirdArgument\n      )\n      document.addEventListener(\n        nativeEvents.up,\n        this.handleMouseUp,\n        thirdArgument\n      )\n      if (isTouchDevice) {\n        document.addEventListener(\n          nativeEvents.mouseMove,\n          this.handleMouseMove,\n          thirdArgument\n        )\n        document.addEventListener(\n          nativeEvents.mouseUp,\n          this.handleMouseUp,\n          thirdArgument\n        )\n      }\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (\n      (this.props.image && this.props.image !== prevProps.image) ||\n      this.props.width !== prevProps.width ||\n      this.props.height !== prevProps.height\n    ) {\n      this.loadImage(this.props.image)\n    } else if (!this.props.image && prevState.image !== defaultEmptyImage) {\n      this.clearImage()\n    }\n\n    const context = this.canvas.getContext('2d')\n    context.clearRect(0, 0, this.canvas.width, this.canvas.height)\n    this.paint(context)\n    this.paintImage(context, this.state.image, this.props.border)\n\n    if (\n      prevProps.image !== this.props.image ||\n      prevProps.width !== this.props.width ||\n      prevProps.height !== this.props.height ||\n      prevProps.position !== this.props.position ||\n      prevProps.scale !== this.props.scale ||\n      prevProps.rotate !== this.props.rotate ||\n      prevState.my !== this.state.my ||\n      prevState.mx !== this.state.mx ||\n      prevState.image.x !== this.state.image.x ||\n      prevState.image.y !== this.state.image.y\n    ) {\n      this.props.onImageChange()\n    }\n  }\n\n  componentWillUnmount() {\n    if (document) {\n      const nativeEvents = deviceEvents.native\n      document.removeEventListener(\n        nativeEvents.move,\n        this.handleMouseMove,\n        false\n      )\n      document.removeEventListener(nativeEvents.up, this.handleMouseUp, false)\n      if (isTouchDevice) {\n        document.removeEventListener(\n          nativeEvents.mouseMove,\n          this.handleMouseMove,\n          false\n        )\n        document.removeEventListener(\n          nativeEvents.mouseUp,\n          this.handleMouseUp,\n          false\n        )\n      }\n    }\n  }\n\n  isVertical() { //!this.props.disableCanvasRotation &&\n    return  this.props.rotate % 180 !== 0\n  }\n\n  getBorders(border = this.props.border) {\n    return Array.isArray(border) ? border : [border, border]\n  }\n\n  getDimensions() {\n    const { width, height, rotate, border } = this.props\n\n    const canvas = {}\n\n    const [borderX, borderY] = this.getBorders(border)\n\n    const canvasWidth = width\n    const canvasHeight = height\n\n    if (this.isVertical()) {\n      canvas.width = canvasHeight\n      canvas.height = canvasWidth\n    } else {\n      canvas.width = canvasWidth\n      canvas.height = canvasHeight\n    }\n\n    canvas.width += borderX * 2\n    canvas.height += borderY * 2\n\n    return {\n      canvas,\n      rotate,\n      width,\n      height,\n      border,\n    }\n  }\n\n  getImage() {\n    // get relative coordinates (0 to 1)\n    const cropRect = this.getCroppingRect()\n    const image = this.state.image\n\n    // get actual pixel coordinates\n    cropRect.x *= image.resource.width\n    cropRect.y *= image.resource.height\n    cropRect.width *= image.resource.width\n    cropRect.height *= image.resource.height\n\n    // create a canvas with the correct dimensions\n    const canvas = document.createElement('canvas')\n\n    if (this.isVertical()) {\n      canvas.width = cropRect.height\n      canvas.height = cropRect.width\n    } else {\n      canvas.width = cropRect.width\n      canvas.height = cropRect.height\n    }\n\n    // draw the full-size image at the correct position,\n    // the image gets truncated to the size of the canvas.\n    const context = canvas.getContext('2d')\n\n    context.translate(canvas.width / 2, canvas.height / 2)\n    context.rotate((this.props.rotate * Math.PI) / 180)\n    context.translate(-(canvas.width / 2), -(canvas.height / 2))\n\n    if (this.isVertical()) {\n      context.translate(\n        (canvas.width - canvas.height) / 2,\n        (canvas.height - canvas.width) / 2\n      )\n    }\n\n    context.drawImage(image.resource, -cropRect.x, -cropRect.y)\n\n    return canvas\n  }\n\n  /**\n   * Get the image scaled to original canvas size.\n   * This was default in 4.x and is now kept as a legacy method.\n   */\n  getImageScaledToCanvas() {\n    const { width, height } = this.getDimensions()\n\n    const canvas = document.createElement('canvas')\n\n    if (this.isVertical()) {\n      canvas.width = height\n      canvas.height = width\n    } else {\n      canvas.width = width\n      canvas.height = height\n    }\n\n    // don't paint a border here, as it is the resulting image\n    this.paintImage(canvas.getContext('2d'), this.state.image, 0, 1)\n\n    return canvas\n  }\n\n  getXScale() {\n    const canvasAspect = this.props.width / this.props.height\n    const imageAspect = this.state.image.width / this.state.image.height\n\n    return Math.min(1, canvasAspect / imageAspect)\n  }\n\n  getYScale() {\n    const canvasAspect = this.props.height / this.props.width\n    const imageAspect = this.state.image.height / this.state.image.width\n\n    return Math.min(1, canvasAspect / imageAspect)\n  }\n\n  getCroppingRect() {\n    const position = this.props.position || {\n      x: this.state.image.x,\n      y: this.state.image.y,\n    }\n    const width = (1 / this.props.scale) * this.getXScale()\n    const height = (1 / this.props.scale) * this.getYScale()\n\n    const croppingRect = {\n      x: position.x - width / 2,\n      y: position.y - height / 2,\n      width,\n      height,\n    }\n\n    let xMin = 0\n    let xMax = 1 - croppingRect.width\n    let yMin = 0\n    let yMax = 1 - croppingRect.height\n\n    // If the cropping rect is larger than the image, then we need to change\n    // our maxima & minima for x & y to allow the image to appear anywhere up\n    // to the very edge of the cropping rect.\n    const isLargerThanImage =\n      this.props.disableBoundaryChecks || width > 1 || height > 1\n\n    if (isLargerThanImage) {\n      xMin = -croppingRect.width\n      xMax = 1\n      yMin = -croppingRect.height\n      yMax = 1\n    }\n\n    return {\n      ...croppingRect,\n      x: Math.max(xMin, Math.min(croppingRect.x, xMax)),\n      y: Math.max(yMin, Math.min(croppingRect.y, yMax)),\n    }\n  }\n\n  loadImage(image) {\n    if (isFileAPISupported && image instanceof File) {\n      this.loadingImage = makeCancelable(loadImageFile(image))\n        .promise.then(this.handleImageReady)\n        .catch(this.props.onLoadFailure)\n    } else if (typeof image === 'string') {\n      this.loadingImage = makeCancelable(\n        loadImageURL(image, this.props.crossOrigin)\n      )\n        .promise.then(this.handleImageReady)\n        .catch(this.props.onLoadFailure)\n    }\n  }\n\n  handleImageReady = image => {\n    const imageState = this.getInitialSize(image.width, image.height)\n    imageState.resource = image\n    imageState.x = 0.5\n    imageState.y = 0.5\n    this.setState({ drag: false, image: imageState }, this.props.onImageReady)\n    this.props.onLoadSuccess(imageState)\n  }\n\n  getInitialSize(width, height) {\n    let newHeight\n    let newWidth\n\n    const dimensions = this.getDimensions()\n    const canvasRatio = dimensions.height / dimensions.width\n    const imageRatio = height / width\n\n    if (canvasRatio > imageRatio) {\n      newHeight = this.getDimensions().height\n      newWidth = width * (newHeight / height)\n    } else {\n      newWidth = this.getDimensions().width\n      newHeight = height * (newWidth / width)\n    }\n\n    return {\n      height: newHeight,\n      width: newWidth,\n    }\n  }\n\n  clearImage = () => {\n    const context = this.canvas.getContext('2d')\n    context.clearRect(0, 0, this.canvas.width, this.canvas.height)\n    this.setState({\n      image: defaultEmptyImage,\n    })\n  }\n\n  paintImage(context, image, border, scaleFactor = pixelRatio) {\n    if (image.resource) {\n      const position = this.calculatePosition(image, border)\n\n      context.save()\n\n      context.translate(context.canvas.width / 2, context.canvas.height / 2)\n      context.rotate((this.props.rotate * Math.PI) / 180)\n      context.translate(\n        -(context.canvas.width / 2),\n        -(context.canvas.height / 2)\n      )\n\n      if (this.isVertical()) {\n        context.translate(\n          (context.canvas.width - context.canvas.height) / 2,\n          (context.canvas.height - context.canvas.width) / 2\n        )\n      }\n\n      context.scale(scaleFactor, scaleFactor)\n\n      context.globalCompositeOperation = 'destination-over'\n      context.drawImage(\n        image.resource,\n        position.x,\n        position.y,\n        position.width,\n        position.height\n      )\n\n      context.restore()\n    }\n  }\n\n  calculatePosition(image, border) {\n    image = image || this.state.image\n\n    const [borderX, borderY] = this.getBorders(border)\n\n    const croppingRect = this.getCroppingRect()\n\n    const width = image.width * this.props.scale\n    const height = image.height * this.props.scale\n\n    let x = -croppingRect.x * width\n    let y = -croppingRect.y * height\n\n    if (this.isVertical()) {\n      x += borderY\n      y += borderX\n    } else {\n      x += borderX\n      y += borderY\n    }\n\n    return {\n      x,\n      y,\n      height,\n      width,\n    }\n  }\n\n  paint(context) {\n    context.save()\n    context.scale(pixelRatio, pixelRatio)\n    context.translate(0, 0)\n    context.fillStyle = 'rgba(' + this.props.color.slice(0, 4).join(',') + ')'\n\n    let borderRadius = this.props.borderRadius\n    const dimensions = this.getDimensions()\n    const [borderSizeX, borderSizeY] = this.getBorders(dimensions.border)\n    const height = dimensions.canvas.height\n    const width = dimensions.canvas.width\n\n    // clamp border radius between zero (perfect rectangle) and half the size without borders (perfect circle or \"pill\")\n    borderRadius = Math.max(borderRadius, 0)\n    borderRadius = Math.min(\n      borderRadius,\n      width / 2 - borderSizeX,\n      height / 2 - borderSizeY\n    )\n\n    context.beginPath()\n    // inner rect, possibly rounded\n    drawRoundedRect(\n      context,\n      borderSizeX,\n      borderSizeY,\n      width - borderSizeX * 2,\n      height - borderSizeY * 2,\n      borderRadius\n    )\n    context.rect(width, 0, -width, height) // outer rect, drawn \"counterclockwise\"\n    context.fill('evenodd')\n\n    context.restore()\n  }\n\n  handleMouseDown = e => {\n    e = e || window.event\n    // if e is a touch event, preventDefault keeps\n    // corresponding mouse events from also being fired\n    // later.\n    e.preventDefault()\n    this.setState({\n      drag: true,\n      mx: null,\n      my: null,\n    })\n  }\n  handleMouseUp = () => {\n    if (this.state.drag) {\n      this.setState({ drag: false })\n      this.props.onMouseUp()\n    }\n  }\n\n\n  getElementScale = (element,scale) => {\n\n    let eScale = 1;\n    if (element.style.transform) {\n      let matrixRegex = /matrix\\(\\s*(-*\\d*\\.*\\d*),\\s*-*\\d*\\.*\\d*,\\s*-*\\d*\\.*\\d*,\\s*(-*\\d*\\.*\\d*),\\s*-*\\d*\\.*\\d*,\\s*-*\\d*\\.*\\d*\\)/gm;\n      let matches = matrixRegex.exec(element.style.transform);\n      if (!matches) {\n        matrixRegex = /scale\\(\\s*(-*\\d*\\.*\\d*)\\)/gm;\n        matches = matrixRegex.exec(element.style.transform);\n      }\n      if (!matches) {\n          eScale=1;\n      } else {\n        eScale=Number(matches[1]);\n      }\n    }\n    scale=scale*eScale;\n    if (element.parentElement) {\n      scale=this.getElementScale(element.parentElement,scale)\n    }\n    return scale;\n  }\n\n  handleMouseMove = e => {\n    e = e || window.event\n    if (this.state.drag === false) {\n      return\n    }\n\n    e.preventDefault() // stop scrolling on iOS Safari\n\n    let scale=1/this.getElementScale(this.props.containerref.current,1);\n\n    const mousePositionX = (e.targetTouches\n      ? e.targetTouches[0].pageX\n      : e.clientX)*scale\n    const mousePositionY = (e.targetTouches\n      ? e.targetTouches[0].pageY\n      : e.clientY)*scale\n\n    const newState = {\n      mx: mousePositionX,\n      my: mousePositionY,\n    }\n\n    let rotate = this.props.rotate\n\n    rotate %= 360\n    rotate = rotate < 0 ? rotate + 360 : rotate\n\n    if (this.state.mx && this.state.my) {\n      const mx = this.state.mx - mousePositionX\n      const my = this.state.my - mousePositionY\n\n      const width = this.state.image.width * this.props.scale\n      const height = this.state.image.height * this.props.scale\n\n      let { x: lastX, y: lastY } = this.getCroppingRect()\n\n      lastX *= width\n      lastY *= height\n\n      // helpers to calculate vectors\n      const toRadians = degree => degree * (Math.PI / 180)\n      const cos = Math.cos(toRadians(rotate))\n      const sin = Math.sin(toRadians(rotate))\n\n      const x = lastX + mx * cos + my * sin\n      const y = lastY + -mx * sin + my * cos\n\n      const relativeWidth = (1 / this.props.scale) * this.getXScale()\n      const relativeHeight = (1 / this.props.scale) * this.getYScale()\n\n      const position = {\n        x: x / width + relativeWidth / 2,\n        y: y / height + relativeHeight / 2,\n      }\n\n      this.props.onPositionChange(position)\n\n      newState.image = {\n        ...this.state.image,\n        ...position,\n      }\n    }\n\n    this.setState(newState)\n\n    this.props.onMouseMove(e)\n  }\n\n  setCanvas = canvas => {\n    this.canvas = canvas\n  }\n\n  render() {\n    const {\n      scale,\n      rotate,\n      image,\n      border,\n      borderRadius,\n      width,\n      height,\n      position,\n      color,\n      // eslint-disable-next-line react/prop-types\n      style,\n      crossOrigin,\n      onLoadFailure,\n      onLoadSuccess,\n      onImageReady,\n      onImageChange,\n      onMouseUp,\n      onMouseMove,\n      onPositionChange,\n      disableBoundaryChecks,\n      disableHiDPIScaling,\n      ...rest\n    } = this.props\n\n    const dimensions = this.getDimensions()\n    const defaultStyle = {\n      width: dimensions.canvas.width,\n      height: dimensions.canvas.height,\n      cursor: this.state.drag ? 'grabbing' : 'grab',\n      touchAction: 'none',\n    }\n\n    const attributes = {\n      width: dimensions.canvas.width * pixelRatio,\n      height: dimensions.canvas.height * pixelRatio,\n      style: {\n        ...defaultStyle,\n        ...style,\n      },\n    }\n\n    attributes[deviceEvents.react.down] = this.handleMouseDown\n    if (isTouchDevice) {\n      attributes[deviceEvents.react.mouseDown] = this.handleMouseDown\n    }\n\n    return <canvas ref={this.setCanvas} {...attributes} {...rest} />\n  }\n}\n\nexport default AvatarEditor\n","/* eslint-env browser, node */\nimport loadImageURL from './load-image-url'\n\nexport default function loadImageFile(imageFile) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.onload = e => {\n      try {\n        const image = loadImageURL(e.target.result)\n        resolve(image)\n      } catch (e) {\n        reject(e)\n      }\n    }\n    reader.readAsDataURL(imageFile)\n  })\n}\n","import React, { Component } from 'react';\r\nimport AvatarEditor from '../improve/react-avatar-editor'\r\n\r\nimport {\r\n  updateImage,\r\n  useImage,\r\n  imagesSaved,\r\n} from '../actions/appActions';\r\n\r\nclass Editor extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state={}\r\n    this.store = this.props.store;\r\n\r\n    this.targetRefs=[];\r\n    this.containerRefs=[];\r\n    for (let i = 0; i < 3; i++) {\r\n      this.targetRefs.push(React.createRef());\r\n      this.containerRefs.push(React.createRef());\r\n    }\r\n\r\n    this.containerRef=React.createRef();\r\n    this.state={}\r\n    this.loadButton_clickHandler=this.loadButton_clickHandler.bind(this);\r\n\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.unsubscribe=this.store.subscribe(()=>{this.onStoreChange()});\r\n    this.mounted=true;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    this.mounted=false;\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState, snapshot) {\r\n  }\r\n\r\n  onStoreChange() {\r\n    if (this.mounted) {\r\n      let state=this.store.getState();\r\n      this.setState(state);\r\n\r\n\r\n      if (state.saveImages) {\r\n\r\n        let images=[];\r\n        for (let i = 0; i < this.targetRefs.length; i++) {\r\n          let targetRef=this.targetRefs[i];\r\n          if (targetRef.current) {\r\n            images.push(targetRef.current.getImageScaledToCanvas().toDataURL(this.state.mimeType));\r\n          } else {\r\n            images.push(null);\r\n          }\r\n        }\r\n        this.store.dispatch(\r\n          imagesSaved(images)\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  loadButton_clickHandler(event) {\r\n    let index=Number(event.target.id.substr(3));\r\n    let file=event.target.files[0];\r\n    if (file) {\r\n      var reader = new FileReader();\r\n\r\n      reader.onload = ((theIndex,store) => {\r\n        return (e) => {\r\n          this.store.dispatch(\r\n            useImage(index,e.target.result)\r\n          );\r\n        };\r\n      })(index,this.store);\r\n      reader.readAsDataURL(file);\r\n    }\r\n  }\r\n\r\n  render() {\r\n\r\n    let children = [];\r\n    children.push(this.props.children);\r\n\r\n    if (this.state.addImagesSrc) {\r\n\r\n      let indexes=[]\r\n      for (let i = 0; i < this.state.addImagesSrc.length; i++) {\r\n        let imageSrc = this.state.addImagesSrc[i];\r\n        let addImageTransform = this.state.addImagesTransform[i];\r\n        let imageTransform = this.state.imagesTransform[i];\r\n\r\n        if ((imageSrc)&&(imageSrc!==\"\")&&(addImageTransform)&&(imageTransform)) {\r\n\r\n          children.push(\r\n            <div\r\n              key={\"cnt\"+i}\r\n              id={\"cnt\"+i}\r\n              className=\"editorImageContainer\"\r\n              ref={this.containerRefs[i]}\r\n              style={{\r\n                transform:`matrix(${addImageTransform})`,\r\n                width:this.state.addImagesDefaultSize.width,\r\n                height:this.state.addImagesDefaultSize.height,\r\n                pointerEvents:(this.state.editable)?\"all\":\"none\",\r\n              }}\r\n            >\r\n              <AvatarEditor\r\n                ref={this.targetRefs[i]}\r\n                image={imageSrc}\r\n                containerref={this.containerRefs[i]}\r\n                width={this.state.addImagesDefaultSize.width}\r\n                height={this.state.addImagesDefaultSize.height}\r\n                border={0}\r\n                scale={imageTransform.s}\r\n                rotate={imageTransform.r}\r\n              />\r\n            </div>\r\n          );\r\n\r\n        } else {\r\n\r\n          children.push(\r\n            <div\r\n              id={\"lBt\"+i}\r\n              key={\"lBt\"+i}\r\n              className=\"loadButton\"\r\n              style={{\r\n                transform:`matrix(${addImageTransform})`,\r\n                width:this.state.addImagesDefaultSize.width,\r\n                height:this.state.addImagesDefaultSize.height,\r\n                pointerEvents:(this.state.editable)?\"all\":\"none\",\r\n              }}\r\n            >\r\n              <input\r\n                id={\"inp\"+i}\r\n                type=\"file\"\r\n                onChange={this.loadButton_clickHandler}\r\n                className=\"loadInput\"\r\n              />\r\n            </div>\r\n          )\r\n        }\r\n      }\r\n    }\r\n\r\n    return React.createElement(\r\n      'div',\r\n      { id:'Editor',\r\n        style:this.props.style,\r\n        ref:this.containerRef,\r\n      },\r\n      children\r\n      );\r\n  }\r\n}\r\n\r\nexport default Editor;\r\n","export const useImage = (index,src) => {\r\n  return {\r\n    type: 'USE_IMAGE',\r\n    index,\r\n    src,\r\n  }\r\n}\r\n\r\nexport const clearImage = (index) => {\r\n  return {\r\n    type: 'CLEAR_IMAGE',\r\n    index,\r\n  }\r\n}\r\n\r\nexport const rotateImage = (index,rotation) => {\r\n  return {\r\n    type: 'ROTATE_IMAGE',\r\n    index,\r\n    rotation,\r\n  }\r\n}\r\n\r\nexport const scaleImage = (index,scale) => {\r\n  return {\r\n    type: 'SCALE_IMAGE',\r\n    index,\r\n    scale,\r\n  }\r\n}\r\n\r\nexport const clearAction = () => {\r\n  return {\r\n    type: 'CLEAR_ACTION',\r\n  }\r\n}\r\n\r\nexport const saveImages = () => {\r\n  return {\r\n    type: 'SAVE_IMAGES',\r\n  }\r\n}\r\n\r\nexport const imagesSaved = (images) => {\r\n  return {\r\n    type: 'IMAGES_SAVED',\r\n    images,\r\n  }\r\n}\r\n\r\n\r\n\r\nexport const appInit = (data) => {\r\n  return {\r\n    type: 'APP_INIT',\r\n    data:{\r\n      ...data,\r\n    },\r\n  }\r\n}\r\n\r\nexport const setStoreData = (data) => {\r\n  return {\r\n    type: 'SET_STORE_DATA',\r\n    data:{\r\n      ...data,\r\n    },\r\n  }\r\n}\r\n\r\nexport const loadStoreDataError = (data) => {\r\n  return {\r\n    type: 'LOAD_STORE_DATA_ERROR',\r\n    data:{\r\n      ...data,\r\n      dataLoaded:false,\r\n      reloadData:false,\r\n      loadDataError:true,\r\n    },\r\n  }\r\n}\r\n\r\nexport const reloadStoreData = () => {\r\n  return {\r\n    type: 'RELOAD_STORE_DATA',\r\n    data:{\r\n      dataLoaded:false,\r\n      reloadData:true,\r\n      loadDataError:false,\r\n    },\r\n  }\r\n}\r\n\r\nexport const waitingForReloadStoreData = () => {\r\n  return {\r\n    type: 'WAITING_FOR_RELOAD_STORE_DATA',\r\n    data:{\r\n      dataLoaded:false,\r\n    },\r\n  }\r\n}\r\n\r\nexport const setAppData = (data) => {\r\n  return {\r\n    type: 'SET_APP_DATA',\r\n    data,\r\n  }\r\n}\r\n\r\nexport const setStorageData = (data) => {\r\n  return {\r\n    type: 'SET_STORAGE_DATA',\r\n    data,\r\n  }\r\n}\r\n\r\nexport const saveStorageData = () => {\r\n  return {\r\n    type: 'SAVE_STORAGE_DATA',\r\n    data:{\r\n      saveStorageData:true,\r\n      dataForStorageChanged:null,\r\n    }\r\n  }\r\n}\r\n\r\nexport const storageDataSaved = () => {\r\n  return {\r\n    type: 'STORAGE_DATA_SAVED',\r\n    data:{\r\n      saveStorageData:false,\r\n    }\r\n  }\r\n}\r\n","import React, { Component } from 'react';\r\n\r\nimport {\r\n  rotateImage,\r\n  scaleImage,\r\n  clearImage,\r\n} from '../actions/appActions';\r\n\r\nclass Controls extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state={}\r\n    this.store = this.props.store;\r\n\r\n    this.containerRefs=[];\r\n    for (let i = 0; i < 10; i++) {\r\n      this.containerRefs.push(React.createRef());\r\n    }\r\n\r\n    this.containerRef=React.createRef();\r\n    this.state={}\r\n\r\n    this.scaleRange_changeHandler=this.scaleRange_changeHandler.bind(this);\r\n    this.rotateRange_changeHandler=this.rotateRange_changeHandler.bind(this);\r\n    this.clearButton_clickHandler=this.clearButton_clickHandler.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.unsubscribe=this.store.subscribe(()=>{this.onStoreChange()});\r\n    this.mounted=true;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    this.mounted=false;\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState, snapshot) {\r\n  }\r\n\r\n  onStoreChange() {\r\n    if (this.mounted) {\r\n      let state=this.store.getState();\r\n      this.setState(state);\r\n    }\r\n  }\r\n\r\n  scaleRange_changeHandler(event) {\r\n    let index=Number(event.target.id.substr(3));\r\n    this.store.dispatch(\r\n      scaleImage(index,event.target.value)\r\n    );\r\n\r\n  }\r\n\r\n  rotateRange_changeHandler(event) {\r\n    let index=Number(event.target.id.substr(3));\r\n    this.store.dispatch(\r\n      rotateImage(index,event.target.value)\r\n    );\r\n  }\r\n\r\n  clearButton_clickHandler(event) {\r\n    let index=Number(event.target.id.substr(3));\r\n    this.store.dispatch(\r\n      clearImage(index,event.target.value)\r\n    );\r\n  }\r\n\r\n\r\n  render() {\r\n\r\n    let children = [];\r\n    children.push(this.props.children);\r\n\r\n    if (this.state.addImagesSrc) {\r\n\r\n      let indexes=[]\r\n      for (let i = 0; i < this.state.addImagesSrc.length; i++) {\r\n        let imageSrc = this.state.addImagesSrc[i];\r\n        let addImageTransform = this.state.addImagesTransform[i];\r\n        let imageTransform = this.state.imagesTransform[i];\r\n\r\n        if ((imageSrc)&&(imageSrc!==\"\")&&(addImageTransform)&&(imageTransform)) {\r\n\r\n          children.push(\r\n            <div\r\n              key={\"ctl\"+i}\r\n              id={\"ctl\"+i}\r\n              className=\"controlsContainer\"\r\n              ref={this.containerRefs[i]}\r\n              style={{\r\n                transform:`matrix(${addImageTransform})`,\r\n                width:this.state.addImagesDefaultSize.width,\r\n                height:this.state.addImagesDefaultSize.height,\r\n              }}\r\n            >\r\n              <input\r\n                type=\"range\"\r\n                id={\"srn\"+i}\r\n                name={\"srn\"+i}\r\n                min={this.state.minScale}\r\n                max={this.state.maxScale}\r\n                step=\"0.01\"\r\n                value={imageTransform.s}\r\n                className=\"scaleRange\"\r\n                onChange={this.scaleRange_changeHandler}\r\n              />\r\n              <input\r\n                type=\"range\"\r\n                id={\"rrn\"+i}\r\n                name={\"rrn\"+i}\r\n                min={this.state.minRotation}\r\n                max={this.state.maxRotation}\r\n                step=\"1\"\r\n                value={imageTransform.r}\r\n                className=\"rotateRange\"\r\n                onChange={this.rotateRange_changeHandler}\r\n              />\r\n              <div\r\n                key={\"ldb\"+i}\r\n                id={\"ldb\"+i}\r\n                className=\"clearImageButton\"\r\n                onClick={this.clearButton_clickHandler}\r\n              ></div>\r\n            </div>\r\n          );\r\n\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n    return React.createElement(\r\n      'div',\r\n      { id:'Controls',\r\n        style:this.props.style,\r\n        ref:this.containerRef,\r\n      },\r\n      children\r\n      );\r\n  }\r\n}\r\n\r\nexport default Controls;\r\n","import React, { Component } from 'react';\r\nimport Editor from './Editor.js'\r\nimport Controls from './Controls.js'\r\n\r\nimport { saveImages } from '../actions/appActions';\r\n\r\nclass EditorPlace extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.store = this.props.store;\r\n\r\n    this.ref=React.createRef()\r\n    this.containerRef=React.createRef()\r\n    this.editorRef=React.createRef()\r\n\r\n    this.state={\r\n      editorScale:.15,\r\n      editorX:0,\r\n      editorY:0,\r\n    }\r\n\r\n    this.continueButton_clickHandler=this.continueButton_clickHandler.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.unsubscribe=this.store.subscribe(()=>{this.onStoreChange()});\r\n    this.mounted=true;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    this.mounted=false;\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState, snapshot) {\r\n    this.updateBounds(this.ref.current.clientWidth,this.ref.current.clientHeight);\r\n  }\r\n\r\n  onStoreChange() {\r\n    if (this.mounted) {\r\n      let state=this.store.getState();\r\n      this.setState({\r\n        ...this.state,\r\n        ...state,\r\n      });\r\n    }\r\n  }\r\n\r\n  updateBounds(width,height) {\r\n    if ((this.lastWidth!==width)||(this.lastHeight!==height)) {\r\n      if (this.state.editorBounds) {\r\n        this.lastWidth=width;\r\n        this.lastHeight=height;\r\n        let bounds=this.state.editorBounds;\r\n        let editorScale=Math.min(width/bounds.width,height/bounds.height);\r\n        let editorX=(width-bounds.width*editorScale)/2/editorScale;\r\n        let editorY=(height-bounds.height*editorScale)/2/editorScale;\r\n        this.setState({\r\n          ...this.state,\r\n          editorScale,\r\n          editorX,\r\n          editorY,\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  continueButton_clickHandler(event) {\r\n    this.store.dispatch(\r\n      saveImages()\r\n    );\r\n  }\r\n\r\n  render() {\r\n\r\n    let children = [];\r\n    children.push(this.props.children);\r\n\r\n    let loadedImageCount=0\r\n    if (this.state.addImagesSrc) {\r\n      for (let i = 0; i < this.state.addImagesSrc.length; i++) {\r\n        if ((this.state.addImagesSrc[i])&&(this.state.addImagesSrc[i]!=\"\")) {\r\n          loadedImageCount++;\r\n        }\r\n      }\r\n    }\r\n\r\n    children.push(\r\n      <div\r\n        id=\"EditorContainer\"\r\n        key=\"EditorContainer\"\r\n        ref={this.containerRef}\r\n        style={{\r\n          width:(this.state.editorBounds)?this.state.editorBounds.width:0,\r\n          height:(this.state.editorBounds)?this.state.editorBounds.height:0,\r\n          transform:`scale(${this.state.editorScale}) translateX(${this.state.editorX}px) translateY(${this.state.editorY}px)`\r\n        }}\r\n      >\r\n        <Editor\r\n          id=\"Editor\"\r\n          key=\"Editor\"\r\n          scale={this.state.editorScale}\r\n          store={this.props.store}\r\n          ref={this.editorRef}\r\n          style={{\r\n            width:(this.state.editorBounds)?this.state.editorBounds.width:0,\r\n            height:(this.state.editorBounds)?this.state.editorBounds.height:0,\r\n          }}\r\n        />\r\n        <img\r\n          id=\"MainImage\"\r\n          key=\"MainImage\"\r\n          src={this.state.mainImageSrc}\r\n          style={{\r\n            opacity:(this.state.editable)?0.90:1,\r\n          }}\r\n        />\r\n        <Controls\r\n          id=\"Controls\"\r\n          key=\"Controls\"\r\n          scale={this.state.editorScale}\r\n          store={this.props.store}\r\n          ref={this.editorRef}\r\n          style={{\r\n            display:(this.state.editable)?\"block\":\"none\",\r\n            width:(this.state.editorBounds)?this.state.editorBounds.width:0,\r\n            height:(this.state.editorBounds)?this.state.editorBounds.height:0,\r\n          }}\r\n        />\r\n\r\n      </div>\r\n    );\r\n\r\n    return React.createElement(\r\n      'div',\r\n      { id:'EditorPlace',\r\n        style:this.props.style,\r\n        ref:this.ref,\r\n      },\r\n      children\r\n      );\r\n  }\r\n}\r\n\r\nexport default EditorPlace;\r\n","import React, { Component } from 'react';\r\n\r\nimport EditorPlace from '../components/EditorPlace.js';\r\n\r\nclass Container extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {}\r\n    this.store = this.props.store;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.unsubscribe=this.store.subscribe(()=>{this.onStoreChange()});\r\n    this.mounted=true;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    this.mounted=false;\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState, snapshot) {\r\n  }\r\n\r\n  onStoreChange() {\r\n    if (this.mounted) {\r\n      let state=this.store.getState();\r\n      this.setState(state);\r\n    }\r\n  }\r\n\r\n  render() {\r\n\r\n    let children = [];\r\n    children.push(this.props.children);\r\n\r\n    children.push(\r\n      <EditorPlace\r\n        store={this.store}\r\n        key=\"EditorPlace\"\r\n        style={{\r\n          right:(this.state.sideMenu)?this.state.sideMenu.width:0,\r\n          top:(this.state.topMenu)?this.state.topMenu.height:0,\r\n        }}\r\n      />\r\n    );\r\n\r\n    return React.createElement(\r\n      'div',\r\n      { id:'Container',\r\n      },\r\n      children\r\n      );\r\n  }\r\n}\r\n\r\nexport default Container;\r\n","import { Component } from 'react';\r\n\r\nimport { setStorageData, storageDataSaved } from '../actions/appActions';\r\n\r\n// import LocalStorageManager from './LocalStorageManager';\r\n\r\nclass DataManager extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.store = this.props.store;\r\n    this.state = {\r\n      isLoading:false,\r\n      isLoaded:false,\r\n    }\r\n    this.loader=null;\r\n    this.result=null;\r\n\r\n  }\r\n\r\n/* ++++ React methods ++++ */\r\n\r\n  componentDidMount() {\r\n    this.unsubscribe=this.store.subscribe(()=>{this.onStoreChange()});\r\n    // this.load();\r\n    this.mounted=true;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    this.mounted=false;\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n  }\r\n\r\n  onStoreChange() {\r\n    if (this.mounted) {\r\n      let state=this.store.getState();\r\n      // this.setState(state);\r\n      if (state.reloadData) {\r\n        // console.log(\"DataManager reloadData\");\r\n        // this.load()\r\n      } else\r\n      if (state.saveStorageData) {\r\n        // console.log(\"DataManager saveStorageData\");\r\n        this.saveStorageData();\r\n      }\r\n    }\r\n  }\r\n\r\n  loadStorageData()\r\n  {\r\n    let data=this.localStorageManager.load();\r\n    this.store.dispatch(\r\n      setStorageData(data)\r\n    );\r\n  }\r\n\r\n  saveStorageData()\r\n  {\r\n    // let state=this.store.getState();\r\n    this.localStorageManager.save({\r\n    });\r\n\r\n    this.store.dispatch(\r\n      storageDataSaved()\r\n    );\r\n  }\r\n\r\n  render () {\r\n    return null;\r\n  }\r\n\r\n}\r\nexport default DataManager;\r\n","import { Component } from 'react';\r\n\r\nimport {\r\n  reloadStoreData,\r\n  saveStorageData,\r\n  clearAction,\r\n } from '../actions/appActions';\r\n\r\nclass Control extends Component {\r\n\r\n  //--------------------------------------------------------------------------\r\n\t//\r\n\t// Constructor\r\n\t//\r\n\t//--------------------------------------------------------------------------\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {};\r\n    this.store = this.props.store;\r\n\r\n    this.actionMap={\r\n    }\r\n\r\n    this.appStartDelay=500;\r\n\r\n    // console.log(\"Control constructor\");\r\n\r\n  }\r\n\r\n\r\n  //--------------------------------------------------------------------------\r\n  //\r\n  // React methods\r\n  //\r\n  //--------------------------------------------------------------------------\r\n\r\n  componentDidMount() {\r\n    this.unsubscribe=this.store.subscribe(()=>{this.onStoreChange()});\r\n    this.mounted=true;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n    }\r\n    this.mounted=false;\r\n  }\r\n\r\n  //--------------------------------------------------------------------------\r\n  //\r\n  // Own methods\r\n  //\r\n  //--------------------------------------------------------------------------\r\n\r\n  onStoreChange() {\r\n    if (this.mounted) {\r\n\r\n      let state=this.store.getState();\r\n\r\n      // this.setState(state);\r\n\r\n      if (state.imageChanged) {\r\n          this.props.app.props.onImage(this.props.app);\r\n          this.store.dispatch(\r\n            clearAction()\r\n          );\r\n      }\r\n\r\n      if (state.imagesSaved) {\r\n          this.props.app.props.onImages(this.props.app,state.resultImagesSrc);\r\n          this.store.dispatch(\r\n            clearAction()\r\n          );\r\n      }\r\n\r\n      //\r\n      //\r\n      // if (state.dataLoaded) {\r\n      //\r\n      //   // console.log(\"Control dataLoaded\",state.windowIsVisible);\r\n      //   if (state.windowIsVisible) {\r\n      //     // console.log(\"Control Wait for next load\");\r\n      //     this.store.dispatch(\r\n      //       waitingForReloadStoreData()\r\n      //     );\r\n      //     this.waitForReload();\r\n      //   } else {\r\n      //     // console.log(\"Tab is inactive. Do not load\");\r\n      //   }\r\n      //\r\n      // } else\r\n      // if (state.loadDataError) {\r\n      //   // console.log(\"Control loadDataError\");\r\n      //   this.store.dispatch(\r\n      //     reloadStoreData()\r\n      //   );\r\n      // } else\r\n      // }\r\n\r\n      if (state.dataForStorageChanged) {\r\n      // console.log(\"Control dataForStorageChanged\");\r\n        this.store.dispatch(\r\n          saveStorageData()\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  stopTimeout() {\r\n    if (this.loadTimeout) {\r\n      clearTimeout(this.loadTimeout)\r\n      this.loadTimeout=null;\r\n    }\r\n  }\r\n\r\n  waitForReload() {\r\n    // console.log(\"Control waitForReload\");\r\n    this.stopTimeout();\r\n\r\n    this.loadTimeout=setTimeout(()=>{\r\n      // console.log(\"Control Reload\");\r\n      this.store.dispatch(\r\n        reloadStoreData()\r\n      );\r\n    },this.store.reloadTimeout);\r\n\r\n  }\r\n\r\n\r\n\r\n  render () {\r\n    return null;\r\n  }\r\n\r\n}\r\n\r\nexport default Control;\r\n","import { isMobile,isLocal } from '../core/helpers';\r\n\r\nconst settings = {\r\n\r\n    assetsUrl: \".\",\r\n    localStoreName:\"appState_261020\",\r\n\r\n    isMobile:isMobile(),\r\n    isLocal:isLocal(),\r\n\r\n    editorBounds:{\r\n      width:0,\r\n      height:0,\r\n    },\r\n\r\n    addImagesDefaultSize:{\r\n      width:500,\r\n      height:500,\r\n    },\r\n\r\n    addImagesDefaultScale:0.5,\r\n\r\n    mainImageSrc:\"\",\r\n    addImagesSrc:[\"\",\"\",\"\"],\r\n    addImagesTransform:[null,null,null],\r\n\r\n    resultImagesSrc:[\"\",\"\",\"\"],\r\n\r\n    minScale:1,\r\n    maxScale:20,\r\n\r\n    minRotation:0,\r\n    maxRotation:360,\r\n\r\n    imagesTransform:[\r\n      {s:1,r:0},\r\n      {s:1,r:0},\r\n      {s:1,r:0},\r\n    ],\r\n\r\n    editable:true,\r\n\r\n}\r\n\r\nexport default settings;\r\n","import MobileDetect from 'mobile-detect'\r\nimport path from \"path\"\r\n\r\nexport const callLater = (callback,delay = 100) => {\r\n  return setTimeout(callback,delay);\r\n}\r\n\r\nexport const isMobile = () => {\r\n  var mobileDetect = new MobileDetect(window.navigator.userAgent);\r\n  return mobileDetect.mobile();\r\n}\r\n\r\nexport const isLocal = () => {\r\n  return !(/^h/.test(document.location.toString()));\r\n}\r\n\r\nexport const objectIsEmpty = (object) => {\r\n  return Object.keys(object).length === 0 && object.constructor === Object;\r\n}\r\n\r\nexport const correctUrl = (url,assetsUrl) => {\r\n\r\n  if (url) {\r\n    if (url.substr(0,1)===\"/\") {\r\n      if (!assetsUrl) {\r\n        assetsUrl=\".\";\r\n      }\r\n      url=path.join(assetsUrl,url);\r\n    }\r\n  }\r\n\r\n  return url;\r\n\r\n}\r\n\r\nexport const openLink = (link) => {\r\n  // let url=correctUrl(link)\r\n  // console.log(\"??\",url);\r\n  window.open(link,\"_blank\")\r\n}\r\n\r\nexport const formatWeight = (weight) => {\r\n  if (weight==null) {\r\n    return \"--Кб\"\r\n  }\r\n\r\n  weight=Number(weight)\r\n  let output=\"\"\r\n\r\n  if (weight>=1000000) {\r\n    output=Math.round(weight*100/1000000)/100+\"Мб\";\r\n  } else\r\n  if (weight>=1000) {\r\n    output=Math.round(weight*100/1000)/100+\"Kб\";\r\n  } else {\r\n    output=weight+\"б\";\r\n  }\r\n  return output\r\n}\r\n\r\nexport const exportCreatives = (creatives,passStatus) => {\r\n  let creativeList=[];\r\n  for (let name in creatives) {\r\n    let creative=creatives[name];\r\n    creativeList.push(creative);\r\n  }\r\n\r\n  creativeList.sort((a,b)=>{\r\n    if (a.section>b.section) return 1;\r\n    if (a.section<b.section) return -1;\r\n\r\n    if (a.publisher>b.publisher) return 1;\r\n    if (a.publisher<b.publisher) return -1;\r\n\r\n    if (a.formatName>b.formatName) return 1;\r\n    if (a.formatName<b.formatName) return -1;\r\n\r\n    if (a.feed>b.feed) return 1;\r\n    if (a.feed<b.feed) return -1;\r\n\r\n    if (a.updateTime>b.updateTime) return 1;\r\n    return -1;\r\n  });\r\n\r\n  let data=[]\r\n  data.push(\r\n    [\r\n      { value:\"Раздел\", type:\"string\" },\r\n      { value:\"Площадка\", type:\"string\" },\r\n      { value:\"Платформа\", type:\"string\" },\r\n      { value:\"Формат\", type:\"string\" },\r\n      { value:\"Фид\", type:\"string\" },\r\n      { value:\"Статус\", type:\"string\" },\r\n      { value:\"Рецензия\", type:\"string\" },\r\n    ]\r\n  );\r\n\r\n  for (let i = 0; i < creativeList.length; i++) {\r\n    let creative=creativeList[i];\r\n    data.push(\r\n      [\r\n        { value:creative.section, type:\"string\" },\r\n        { value:creative.publisher, type:\"string\" },\r\n        { value:creative.platform, type:\"string\" },\r\n        { value:creative.formatName, type:\"string\" },\r\n        { value:creative.feed, type:\"string\" },\r\n        { value:creative.state, type:\"string\" },\r\n        { value:passStatus[creative.name]?\"Принят\":\"Не принят\", type:\"string\" },\r\n      ]\r\n    );\r\n  }\r\n\r\n  return data;\r\n}\r\n","import React, { Component } from 'react';\n\nimport mainReducer from './reducers/mainReducer'\nimport Container from './core/Container';\n\nimport DataManager from './core/DataManager';\nimport Control from './core/Control';\n\nimport { Provider } from 'react-redux'\nimport { createStore } from 'redux'\n\nimport { appInit, setStoreData, saveImages } from './actions/appActions';\n\nimport settings from './configuration/Settings';\n\nimport './css/app.css';\n\nconst Store = createStore(\n  mainReducer,\n  window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()\n);\n\nclass App extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {}\n\n    this.initHandler=this.initHandler.bind(this);\n    this.resizeHandler=this.resizeHandler.bind(this);\n  }\n\n  updateLayout() {\n    let windowInnerWidth=document.documentElement.clientWidth || document.body.clientWidth || window.innerWidth;\n    let windowInnerHeight=document.documentElement.clientHeight || document.body.clientHeight || window.innerHeight;\n\n    this.setState({\n      ...this.state,\n      windowWidth:windowInnerWidth,\n      windowHeight:windowInnerHeight,\n    });\n\n  }\n\n  initHandler(event) {\n    this.updateLayout();\n  }\n\n  resizeHandler(event) {\n    this.updateLayout();\n  }\n\n  setData(data) {\n    Store.dispatch(\n      setStoreData(data)\n    );\n  }\n\n  getData(data) {\n    return Store.getState();\n  }\n\n  saveImages() {\n    Store.dispatch(\n      saveImages()\n    );\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n  }\n\n  componentDidMount() {\n    Store.dispatch(\n      appInit(settings)\n    );\n\n    window.addEventListener(\"load\",this.initHandler);\n    window.addEventListener(\"resize\",this.resizeHandler);\n\n    // window.editorApp=this;\n    // if (window.onEditorAppReady) {\n    //   window.onEditorAppReady(this);\n    // }\n\n    this.props.onInit(this);\n\n  }\n\n  render() {\n    return (\n      <Provider store={Store}>\n        <Container\n          id=\"Container\"\n          windowWidth={this.state.windowWidth}\n          windowHeight={this.state.windowHeight}\n          store={Store}\n        >\n          <DataManager\n            store={Store}\n          />\n          <Control\n            app={this}\n            store={Store}\n          />\n        </Container>\n      </Provider>\n    );\n  }\n\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nlet element=document.getElementById('editorWidget');\n\nconsole.log(element.getAttribute(\"oninit\"));\n\nReactDOM.render(\n  <React.StrictMode>\n    <App\n      id=\"editorApp\"\n      onInit={window[element.getAttribute(\"oninit\")]}\n      onImage={window[element.getAttribute(\"onimage\")]}\n      onImages={window[element.getAttribute(\"onimages\")]}\n    />\n  </React.StrictMode>,\n  element\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}